<!DOCTYPE html>
<html>
<head>
  <title>Escuela Federal de Formación Judicial</title>
  <!-- Incluir Bootstrap CSS desde un CDN -->
  <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
  <!-- Agregar estilos personalizados -->
  <style>
    body {
      padding: 20px;
    }
    .container {
      max-width: 600px;
      margin: auto;
    }
    h1 {
      text-align: center;
      margin-bottom: 20px;
    }
    #selected-directory {
      margin-top: 10px;
      font-weight: bold;
    }
    #log {
      margin-top: 20px;
      height: 200px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Secciona PDF´s en páginas</h1>
    <div class="text-center">
      <button id="select-directory" class="btn btn-primary">Seleccionar Directorio</button>
    </div>
    <p id="selected-directory" class="text-center text-muted">No se ha seleccionado un directorio</p>
    <textarea id="log" class="form-control" readonly></textarea>
  </div>
  <!-- Incluir jQuery y Bootstrap JS desde un CDN -->
  <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
  <script>
    function logMessage(message) {
      const logElement = document.getElementById('log');
      logElement.value += message + '\n';
      logElement.scrollTop = logElement.scrollHeight;
      console.log(message);
    }

    document.getElementById('select-directory').addEventListener('click', async () => {
      const directoryPath = await window.electron.selectDirectory();
      const selectedDirectoryElement = document.getElementById('selected-directory');
      selectedDirectoryElement.innerText = directoryPath ? `Directorio Seleccionado: ${directoryPath}` : 'No se ha seleccionado un directorio';
      selectedDirectoryElement.className = directoryPath ? 'text-center text-success' : 'text-center text-muted';
      if (directoryPath) {
        // Llama a la función para procesar PDFs
        processPDFs(directoryPath);
      }
    });

    async function processPDFs(directoryPath) {
      logMessage(`Procesando archivos en el directorio: ${directoryPath}`);
      const response = await fetch('http://localhost:3000/process-pdfs', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({ path: directoryPath })
      });
      const result = await response.json();
      logMessage(`Archivos procesados: ${result.processedFilesCount}`);
      logMessage(`PDFs generados: ${result.generatedPdfsCount}`);
      result.details.forEach(detail => {
        logMessage(detail);
      });
      alert(`Archivos procesados: ${result.processedFilesCount}, PDFs generados: ${result.generatedPdfsCount}`);
    }
  </script>
</body>
</html>
